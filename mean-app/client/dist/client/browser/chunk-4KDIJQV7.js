import{g as x}from"./chunk-OCZNNLXB.js";import{E as V}from"./chunk-JFETNEWJ.js";import{a as F,b as a,c as M,d as O,g as N,h as D,i as S,j as P,k as I,l as E,m as A,n as T,o as R,q as k,r as w,s as G}from"./chunk-SWTIH3DO.js";import{a as q}from"./chunk-WAGXJ3BI.js";import{Ab as n,Bb as u,Fb as v,Hb as d,Ib as y,Kc as _,Sa as g,Sc as C,Wb as i,bb as c,ga as p,ha as f,hb as h,lb as b,yb as l,zb as o}from"./chunk-24VTUSTZ.js";function U(s,r){if(s&1){let e=v();o(0,"div",10),u(1,"input",11)(2,"input",12)(3,"input",13)(4,"input",14),o(5,"select",15)(6,"option",16),i(7,"Income"),n(),o(8,"option",17),i(9,"Expense"),n()(),o(10,"button",6),d("click",function(){let m=p(e),z=m.$implicit,B=m.index,J=y();return f(J.removeTransaction(B,z.value.id))}),i(11,"Remove"),n()()}if(s&2){let e=r.index;l("formGroupName",e)}}var j=class s{constructor(r,e,t,m){this.fb=r;this.dashboardService=e;this.router=t;this.dialogRef=m;this.dashboardForm=this.fb.group({monthlyIncome:[0,a.required],monthlyExpenses:[0,a.required],estimatedTaxDue:[0],savingsRate:[0],transactions:this.fb.array([])})}dashboardForm;userId="";ngOnInit(){let r=sessionStorage.getItem("current_user")||localStorage.getItem("current_user");if(!r)return console.error("No user logged in.");this.userId=JSON.parse(r).id,this.dashboardService.getDashboard(this.userId).subscribe({next:e=>{if(e){for(this.dashboardForm.patchValue({monthlyIncome:e.monthlyIncome,monthlyExpenses:e.monthlyExpenses,estimatedTaxDue:e.estimatedTaxDue,savingsRate:e.savingsRate});this.transactions.length;)this.transactions.removeAt(0);e.transactions?.length&&e.transactions.forEach(t=>{this.transactions.push(this.fb.group({date:[t.date?t.date.split("T")[0]:"",a.required],description:[t.description],category:[t.category],amount:[t.amount,a.required],type:[t.type,a.required]}))})}},error:()=>console.error("Error fetching dashboard")})}get transactions(){return this.dashboardForm.get("transactions")}addTransaction(){this.transactions.push(this.fb.group({date:["",a.required],description:[""],category:[""],amount:[0,a.required],type:["Expense",a.required]}))}removeTransaction(r,e){if(!e){this.transactions.removeAt(r);return}this.dashboardService.deleteTransaction(this.userId,e).subscribe({next:()=>{console.log("Transaction deleted successfully"),this.transactions.removeAt(r)},error:t=>console.error("Error deleting transaction",t)})}submitForm(){if(!this.userId)return console.error("Cannot save dashboard, userId missing.");if(this.dashboardForm.valid){let r={monthlyIncome:this.dashboardForm.value.monthlyIncome,monthlyExpenses:this.dashboardForm.value.monthlyExpenses,estimatedTaxDue:this.dashboardForm.value.estimatedTaxDue,savingsRate:this.dashboardForm.value.savingsRate,transactions:this.dashboardForm.value.transactions,user:this.userId};this.dashboardService.updateDashboard(this.userId,r).subscribe({next:()=>{console.log("Dashboard saved successfully"),this.dialogRef?this.dialogRef.close(this.dashboardForm.value):this.router.navigate(["/dashboard"])},error:e=>console.error("Error saving dashboard",e)})}else console.warn("Form is invalid")}static \u0275fac=function(e){return new(e||s)(c(k),c(q),c(x),c(V,8))};static \u0275cmp=h({type:s,selectors:[["app-dashboard-form"]],decls:14,vars:2,consts:[[1,"form-container",3,"ngSubmit","formGroup"],[1,"row"],["type","number","formControlName","monthlyIncome","placeholder","Monthly Income"],["type","number","formControlName","monthlyExpenses","placeholder","Monthly Expenses"],["type","number","formControlName","estimatedTaxDue","placeholder","Estimated Tax Due"],["type","number","formControlName","savingsRate","placeholder","Savings Rate (%)"],["type","button",3,"click"],["formArrayName","transactions"],[3,"formGroupName",4,"ngFor","ngForOf"],["type","submit"],[3,"formGroupName"],["type","date","formControlName","date"],["type","text","formControlName","description","placeholder","Description"],["type","text","formControlName","category","placeholder","Category"],["type","number","formControlName","amount","placeholder","Amount"],["formControlName","type"],["value","Income"],["value","Expense"]],template:function(e,t){e&1&&(o(0,"form",0),d("ngSubmit",function(){return t.submitForm()}),o(1,"div",1),u(2,"input",2)(3,"input",3)(4,"input",4)(5,"input",5),n(),o(6,"h4"),i(7,"Transactions"),n(),o(8,"button",6),d("click",function(){return t.addTransaction()}),i(9,"+ Add Transaction"),n(),o(10,"div",7),b(11,U,12,1,"div",8),n(),o(12,"button",9),i(13,"Save Dashboard"),n()()),e&2&&(l("formGroup",t.dashboardForm),g(11),l("ngForOf",t.transactions.controls))},dependencies:[C,_,G,N,T,R,F,D,A,M,O,S,E,P,I,w],styles:[".form-container[_ngcontent-%COMP%]{padding:1.5rem;border-radius:8px;background-color:#fff;max-height:80vh;overflow-y:auto;display:flex;flex-direction:column;gap:1rem;box-shadow:0 4px 12px #00000026}.row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;width:100%}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:.6rem .8rem;border:1px solid #ccc;border-radius:6px;width:100%;font-size:.95rem;transition:border-color .2s}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus{border-color:#3f51b5;outline:none}h4[_ngcontent-%COMP%]{margin-top:1rem;font-size:1.1rem;color:#333}button[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;border-radius:6px;cursor:pointer;font-size:.95rem;transition:all .2s}button[type=submit][_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;align-self:flex-start}button[type=submit][_ngcontent-%COMP%]:hover{background-color:#303f9f}button[type=button][_ngcontent-%COMP%]{background-color:#f5f5f5;color:#333}button[type=button][_ngcontent-%COMP%]:hover{background-color:#e0e0e0}[formArrayName=transactions][_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px;margin-top:.5rem;align-items:center}[formArrayName=transactions][_ngcontent-%COMP%]   input[_ngcontent-%COMP%], [formArrayName=transactions][_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{font-size:.9rem}[formArrayName=transactions][_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}[formArrayName=transactions][_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#d32f2f}button[ng-reflect-type=button][_ngcontent-%COMP%]:not([formArrayName]){margin:.5rem 0;background-color:#4caf50;color:#ede8e8}button[ng-reflect-type=button][_ngcontent-%COMP%]:not([formArrayName]):hover{background-color:#388e3c}@media (max-width: 768px){.row[_ngcontent-%COMP%]{grid-template-columns:1fr}[formArrayName=transactions][_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{j as a};
