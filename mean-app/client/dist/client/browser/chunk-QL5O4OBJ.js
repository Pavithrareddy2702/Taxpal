import{a as X}from"./chunk-QUZCL42G.js";import{c as j,g as A,l as z}from"./chunk-OCZNNLXB.js";import{c as L,d as H,e as Y,f as $,g as B,m as q,n as G,o as Q,p as W,r as J}from"./chunk-SWTIH3DO.js";import{a as K}from"./chunk-L6XRWYET.js";import{a as N,b as V}from"./chunk-Q5QP427L.js";import{$ as M,Ab as n,Bb as C,Fb as P,Hb as s,Ib as u,Kc as D,Lc as U,Pc as I,Qa as S,Sa as p,Sc as F,Wb as o,X as R,Xb as b,Yb as y,Zb as k,a as x,b as _,bb as f,ga as d,gc as E,ha as m,hb as O,ic as T,lb as h,qa as v,yb as g,zb as t}from"./chunk-24VTUSTZ.js";var w=class l{constructor(e){this.http=e}apiUrl=`${K.apiUrl}/reports`;getHeaders(){let e=localStorage.getItem("token");return new N({Authorization:`Bearer ${e}`,"Content-Type":"application/json"})}getReports(e){return this.http.get(`${this.apiUrl}/${e}`,{headers:this.getHeaders()})}generateReport(e){return this.http.post(`${this.apiUrl}/generate`,e,{headers:this.getHeaders()})}downloadReport(e,r){return this.http.get(`${this.apiUrl}/download/${e}`,{headers:this.getHeaders(),responseType:"blob"})}static \u0275fac=function(r){return new(r||l)(M(V))};static \u0275prov=R({token:l,factory:l.\u0275fac,providedIn:"root"})};function ne(l,e){l&1&&(t(0,"tr")(1,"td",35),o(2,"No results."),n()())}function re(l,e){if(l&1){let r=P();t(0,"tr")(1,"td"),o(2),n(),t(3,"td"),o(4),E(5,"date"),n(),t(6,"td"),o(7),n(),t(8,"td"),o(9),n(),t(10,"td",36)(11,"button",37),s("click",function(){let a=d(r).$implicit,c=u();return m(c.previewReport(a))}),o(12," \u{1F441}\uFE0F Preview "),n(),t(13,"button",38),s("click",function(){let a=d(r).$implicit,c=u();return m(c.downloadReport(a))}),o(14," \u2B07\uFE0F Download "),n()()()}if(l&2){let r=e.$implicit;p(2),b(r.reportType),p(2),y(" ",r.generatedAt?T(5,4,r.generatedAt,"short"):r.status," "),p(3),b(r.period),p(2),b(r.format)}}function oe(l,e){if(l&1){let r=P();t(0,"div",39),s("click",function(){d(r);let a=u();return m(a.closePreview())}),t(1,"div",40),s("click",function(a){return d(r),m(a.stopPropagation())}),t(2,"div",41)(3,"div",42)(4,"span",43),o(5,"\u{1F4C4}"),n(),t(6,"div")(7,"h3"),o(8),n(),t(9,"p",44),o(10),n()()(),t(11,"div",45)(12,"button",46),s("click",function(){d(r);let a=u();return m(a.printReport())}),o(13," \u{1F5A8}\uFE0F Print "),n(),t(14,"button",47),s("click",function(){d(r);let a=u();return m(a.closePreview())}),o(15," \u2716\uFE0F "),n()()(),t(16,"div",48),C(17,"iframe",49),n(),t(18,"div",50)(19,"button",51),s("click",function(){d(r);let a=u();return m(a.downloadReport(a.selectedReport))}),o(20," \u2B07\uFE0F Download Report "),n(),t(21,"button",52),s("click",function(){d(r);let a=u();return m(a.closePreview())}),o(22," Cancel "),n()()()()}if(l&2){let r=u();p(8),b(r.selectedReport==null?null:r.selectedReport.reportType),p(2),k("",r.selectedReport==null?null:r.selectedReport.period," \u2022 ",r.selectedReport==null?null:r.selectedReport.format),p(7),g("src",r.previewUrl,S)}}var Z=class l{constructor(e,r,i,a){this.reportsService=e;this.authService=r;this.router=i;this.sanitizer=a}isFormVisible=v(!1);newReport=v({reportType:null,reportPeriod:null,format:"PDF"});recentReports=[];userInitials="";currentUser={id:"",fullName:"",email:"",username:""};selectedReport=null;previewUrl=null;showPreviewModal=v(!1);ngOnInit(){this.loadCurrentUser()}loadCurrentUser(){let e=this.authService.getCurrentUser();e?(this.currentUser=e,this.setUserInitials(e.fullName),this.fetchReports()):this.router.navigate(["/login"])}setUserInitials(e){if(!e){this.userInitials="";return}let r=e.trim().split(" ");this.userInitials=r.map(i=>i.charAt(0).toUpperCase()).join("")}fetchReports(){this.currentUser.id&&this.reportsService.getReports(this.currentUser.id).subscribe({next:e=>this.recentReports=e||[],error:e=>{console.error("Error fetching reports:",e),this.recentReports=[]}})}generateReport(){let e=this.newReport();if(!e.reportType||!e.reportPeriod){console.error("Please fill in report type and period");return}if(!this.currentUser.id){console.error("User not logged in");return}let r={userId:this.currentUser.id,reportType:e.reportType,period:e.reportPeriod,format:e.format};e.reportPeriod==="Custom"&&e.customPeriod&&(r.customPeriod=e.customPeriod),console.log("Payload for report generation:",r),this.reportsService.generateReport(r).subscribe({next:i=>{console.log("Report generation started:",i),i.success&&i.data&&this.recentReports.unshift(i.data),this.resetForm(),this.isFormVisible.set(!1)},error:i=>console.error("Error generating report:",i)})}resetForm(){this.newReport.set({reportType:null,reportPeriod:null,format:"PDF"})}downloadReport(e){!e._id||!e.format||this.reportsService.downloadReport(e._id,e.format).subscribe({next:r=>{let i=window.URL.createObjectURL(r),a=document.createElement("a");a.href=i,a.download=e.fileName||`${e.reportType}.${e.format.toLowerCase()}`,a.click(),window.URL.revokeObjectURL(i)},error:r=>console.error("Download failed:",r)})}previewReport(e){e._id&&(this.selectedReport=e,this.reportsService.downloadReport(e._id,e.format).subscribe({next:r=>{let i=window.URL.createObjectURL(r);this.previewUrl=this.sanitizer.bypassSecurityTrustResourceUrl(i),this.showPreviewModal.set(!0)},error:r=>{console.error("Preview failed:",r),alert("Failed to preview report")}}))}closePreview(){this.showPreviewModal.set(!1),this.selectedReport=null,this.previewUrl&&(this.previewUrl=null)}printReport(){if(!this.previewUrl)return;let e=document.querySelector("#previewIframe");e&&e.contentWindow&&e.contentWindow.print()}addReport(){this.generateReport()}updateNewReportType(e){this.newReport.set(_(x({},this.newReport()),{reportType:e}))}updateNewReportPeriod(e){this.newReport.set(_(x({},this.newReport()),{reportPeriod:e}))}updateNewReportFormat(e){this.newReport.set(_(x({},this.newReport()),{format:e||"PDF"}))}static \u0275fac=function(r){return new(r||l)(f(w),f(X),f(A),f(j))};static \u0275cmp=O({type:l,selectors:[["app-reports"]],decls:79,vars:6,consts:[["name","viewport","content","width=device-width, initial-scale=1, shrink-to-fit=no"],[1,"reports-container"],[1,"subtitle"],[1,"generate-report","card"],[1,"report-form",3,"ngSubmit"],[1,"form-group"],["for","reportType"],["id","reportType","name","reportType","required","",3,"ngModelChange","ngModel"],["value",""],["value","Income Statement"],["value","Expense Report"],["value","Tax Summary"],["value","Budget Analysis"],["value","Cash Flow Statement"],["for","period"],["id","period","name","period","required","",3,"ngModelChange","ngModel"],["value","Current Month"],["value","Last Month"],["value","Current Quarter"],["value","Last Quarter"],["value","Current Year"],["value","Last Year"],["value","Custom"],["for","format"],["id","format","name","format","required","",3,"ngModelChange","ngModel"],["value","PDF"],["value","Excel"],["value","CSV"],[1,"buttons"],["type","reset",1,"reset-btn",3,"click"],["type","submit",1,"generate-btn"],[1,"recent-reports","card"],[4,"ngIf"],[4,"ngFor","ngForOf"],["class","preview-modal",3,"click",4,"ngIf"],["colspan","5",1,"no-results"],[1,"action-cell"],["title","Preview",1,"action-btn","preview-btn",3,"click"],["title","Download",1,"action-btn","download-btn",3,"click"],[1,"preview-modal",3,"click"],[1,"preview-content",3,"click"],[1,"preview-header"],[1,"preview-title"],[1,"icon"],[1,"preview-subtitle"],[1,"preview-actions"],["title","Print",1,"icon-btn","print-btn",3,"click"],["title","Close",1,"icon-btn","close-btn",3,"click"],[1,"preview-body"],["id","previewIframe","frameborder","0",1,"pdf-viewer",3,"src"],[1,"preview-footer"],[1,"footer-btn","download-btn",3,"click"],[1,"footer-btn","cancel-btn",3,"click"]],template:function(r,i){r&1&&(C(0,"meta",0),t(1,"div",1)(2,"h2"),o(3,"Financial Reports"),n(),t(4,"p",2),o(5,"Generate and download your financial reports"),n(),t(6,"div",3)(7,"form",4),s("ngSubmit",function(){return i.addReport()}),t(8,"div",5)(9,"label",6),o(10,"Report Type"),n(),t(11,"select",7),s("ngModelChange",function(c){return i.updateNewReportType(c)}),t(12,"option",8),o(13,"Select Type"),n(),t(14,"option",9),o(15,"Income Statement"),n(),t(16,"option",10),o(17,"Expense Report"),n(),t(18,"option",11),o(19,"Tax Summary"),n(),t(20,"option",12),o(21,"Budget Analysis"),n(),t(22,"option",13),o(23,"Cash Flow Statement"),n()()(),t(24,"div",5)(25,"label",14),o(26,"Period"),n(),t(27,"select",15),s("ngModelChange",function(c){return i.updateNewReportPeriod(c)}),t(28,"option",8),o(29,"Select Period"),n(),t(30,"option",16),o(31,"Current Month"),n(),t(32,"option",17),o(33,"Last Month"),n(),t(34,"option",18),o(35,"Current Quarter"),n(),t(36,"option",19),o(37,"Last Quarter"),n(),t(38,"option",20),o(39,"Current Year"),n(),t(40,"option",21),o(41,"Last Year"),n(),t(42,"option",22),o(43,"Custom"),n()()(),t(44,"div",5)(45,"label",23),o(46,"Format"),n(),t(47,"select",24),s("ngModelChange",function(c){return i.updateNewReportFormat(c)}),t(48,"option",25),o(49,"PDF"),n(),t(50,"option",26),o(51,"Excel"),n(),t(52,"option",27),o(53,"CSV"),n()()(),t(54,"div",28)(55,"button",29),s("click",function(){return i.resetForm()}),o(56,"Reset"),n(),t(57,"button",30),o(58,"Generate Report"),n()()()(),t(59,"div",31)(60,"h3"),o(61,"Recent Reports"),n(),t(62,"table")(63,"thead")(64,"tr")(65,"th"),o(66,"Report Name"),n(),t(67,"th"),o(68,"Generated"),n(),t(69,"th"),o(70,"Period"),n(),t(71,"th"),o(72,"Format"),n(),t(73,"th"),o(74,"Actions"),n()()(),t(75,"tbody"),h(76,ne,3,0,"tr",32)(77,re,15,7,"tr",33),n()()(),h(78,oe,23,4,"div",34),n()),r&2&&(p(11),g("ngModel",i.newReport().reportType),p(16),g("ngModel",i.newReport().reportPeriod),p(20),g("ngModel",i.newReport().format),p(29),g("ngIf",i.recentReports.length===0),p(),g("ngForOf",i.recentReports),p(),g("ngIf",i.showPreviewModal()))},dependencies:[F,D,U,J,B,G,Q,q,L,H,W,$,Y,z,I],styles:["[_nghost-%COMP%]{display:block;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial}.reports-container[_ngcontent-%COMP%]{padding:20px;font-family:Arial,sans-serif}.subtitle[_ngcontent-%COMP%]{color:gray;margin-bottom:15px}.card[_ngcontent-%COMP%]{background:#fff;padding:15px;border-radius:8px;margin-bottom:20px;box-shadow:0 2px 6px #0000001a}.report-form[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:20px;align-items:flex-end}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:200px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:5px}select[_ngcontent-%COMP%]{padding:6px;border-radius:6px;border:1px solid #ccc}.buttons[_ngcontent-%COMP%]{display:flex;gap:10px}.reset-btn[_ngcontent-%COMP%], .generate-btn[_ngcontent-%COMP%]{padding:8px 15px;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:all .2s}.reset-btn[_ngcontent-%COMP%]{background:#2fa79a;color:#fff}.reset-btn[_ngcontent-%COMP%]:hover{background:#268a7e;transform:translateY(-1px)}.generate-btn[_ngcontent-%COMP%]{background:#10b981;color:#fff}.generate-btn[_ngcontent-%COMP%]:hover{background:#059669;transform:translateY(-1px)}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:15px}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #ddd;padding:10px;text-align:left}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f8f9fa;font-weight:600;color:#495057}.no-results[_ngcontent-%COMP%]{text-align:center;color:gray;padding:20px}.action-cell[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap}.action-btn[_ngcontent-%COMP%]{padding:6px 12px;border:none;border-radius:6px;cursor:pointer;font-size:13px;font-weight:600;transition:all .2s;display:inline-flex;align-items:center;gap:4px}.action-btn.preview-btn[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.action-btn.preview-btn[_ngcontent-%COMP%]:hover{background:#2563eb;transform:translateY(-1px);box-shadow:0 4px 8px #3b82f64d}.action-btn.download-btn[_ngcontent-%COMP%]{background:#10b981;color:#fff}.action-btn.download-btn[_ngcontent-%COMP%]:hover{background:#059669;transform:translateY(-1px);box-shadow:0 4px 8px #10b9814d}.preview-modal[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:9999;padding:20px;animation:_ngcontent-%COMP%_fadeIn .2s ease-in}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.preview-content[_ngcontent-%COMP%]{background:#fff;border-radius:12px;width:100%;max-width:1200px;height:90vh;display:flex;flex-direction:column;box-shadow:0 20px 60px #00000080;animation:_ngcontent-%COMP%_slideUp .3s ease-out}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(50px);opacity:0}to{transform:translateY(0);opacity:1}}.preview-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:2px solid #e5e7eb;background:linear-gradient(135deg,#f8fafc,#f1f5f9);border-radius:12px 12px 0 0}.preview-header[_ngcontent-%COMP%]   .preview-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.preview-header[_ngcontent-%COMP%]   .preview-title[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:32px}.preview-header[_ngcontent-%COMP%]   .preview-title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:20px;color:#1e293b;font-weight:700}.preview-header[_ngcontent-%COMP%]   .preview-title[_ngcontent-%COMP%]   .preview-subtitle[_ngcontent-%COMP%]{margin:4px 0 0;font-size:14px;color:#64748b}.preview-header[_ngcontent-%COMP%]   .preview-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.icon-btn[_ngcontent-%COMP%]{padding:10px 16px;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:600;transition:all .2s;display:flex;align-items:center;gap:6px}.icon-btn.print-btn[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.icon-btn.print-btn[_ngcontent-%COMP%]:hover{background:#2563eb;transform:translateY(-2px);box-shadow:0 4px 12px #3b82f666}.icon-btn.close-btn[_ngcontent-%COMP%]{background:#ef4444;color:#fff}.icon-btn.close-btn[_ngcontent-%COMP%]:hover{background:#dc2626;transform:translateY(-2px);box-shadow:0 4px 12px #ef444466}.preview-body[_ngcontent-%COMP%]{flex:1;padding:0;overflow:hidden;background:#f8fafc}.pdf-viewer[_ngcontent-%COMP%]{width:100%;height:100%;border:none;background:#fff}.preview-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;padding:16px 24px;border-top:2px solid #e5e7eb;background:#f8fafc;border-radius:0 0 12px 12px}.footer-btn[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:600;transition:all .2s}.footer-btn.download-btn[_ngcontent-%COMP%]{background:#10b981;color:#fff}.footer-btn.download-btn[_ngcontent-%COMP%]:hover{background:#059669;transform:translateY(-2px);box-shadow:0 4px 12px #10b9814d}.footer-btn.cancel-btn[_ngcontent-%COMP%]{background:#e5e7eb;color:#374151}.footer-btn.cancel-btn[_ngcontent-%COMP%]:hover{background:#d1d5db}@media (max-width: 768px){.preview-content[_ngcontent-%COMP%]{height:95vh}.preview-header[_ngcontent-%COMP%]{flex-direction:column;gap:12px;align-items:flex-start}.preview-header[_ngcontent-%COMP%]   .preview-actions[_ngcontent-%COMP%]{width:100%;justify-content:flex-end}.preview-footer[_ngcontent-%COMP%]{flex-direction:column}.preview-footer[_ngcontent-%COMP%]   .footer-btn[_ngcontent-%COMP%]{width:100%}.action-cell[_ngcontent-%COMP%]{flex-direction:column}.action-cell[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{width:100%}}"],changeDetection:0})};export{Z as ReportsComponent};
