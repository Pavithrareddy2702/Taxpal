import{a as N}from"./chunk-QUZCL42G.js";import{e as F,g as E}from"./chunk-OCZNNLXB.js";import{a as S,b as w,c as R,d as I,g as D,i as T,l as L,q as z,s as q}from"./chunk-SWTIH3DO.js";import"./chunk-L6XRWYET.js";import"./chunk-Q5QP427L.js";import{Ab as o,Bb as u,Fb as y,Hb as p,Ib as f,Lc as k,S as x,Sa as a,Sc as O,Ub as h,Wb as s,Yb as g,a as b,bb as m,c as P,ga as v,ha as C,hb as M,i as _,lb as c,yb as l,zb as r}from"./chunk-24VTUSTZ.js";function A(i,e){if(i&1&&(r(0,"div",29),s(1),o()),i&2){let n=f();a(),g(" ",n.getFieldError("newPassword")," ")}}function $(i,e){if(i&1&&(r(0,"div",29),s(1),o()),i&2){let n=f();a(),g(" ",n.getFieldError("confirmPassword")," ")}}function G(i,e){if(i&1&&(r(0,"div",30),s(1),o()),i&2){let n=f();a(),g(" ",n.errorMessage," ")}}function Y(i,e){i&1&&(r(0,"span"),s(1,"Reset Password"),o())}function U(i,e){i&1&&(r(0,"span",31),s(1,"Resetting..."),o())}function H(i,e){i&1&&(r(0,"div",32)(1,"h3"),s(2,"Password Reset Successfully!"),o(),r(3,"p"),s(4,"Your password has been updated. You will be redirected to login..."),o()())}function J(i,e){if(i&1){let n=y();r(0,"a",33),p("click",function(){v(n);let d=f();return C(d.requestNewResetLink())}),s(1," Request New Reset Link "),o()}}var j=class i{constructor(e,n,t,d){this.formBuilder=e;this.router=n;this.route=t;this.authService=d;this.resetPasswordForm=this.formBuilder.group({newPassword:["",[w.required,w.minLength(6)]],confirmPassword:["",[w.required]]},{validators:this.passwordMatchValidator})}resetPasswordForm;isLoading=!1;showSuccessMessage=!1;errorMessage="";showPassword=!1;showConfirmPassword=!1;resetToken="";destroy$=new _;ngOnInit(){this.resetToken=this.route.snapshot.params.token,this.resetToken||(this.errorMessage="Invalid reset link. Please request a new password reset."),this.authService.isLoading$&&this.authService.isLoading$.pipe(x(this.destroy$)).subscribe(e=>this.isLoading=e)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}passwordMatchValidator(e){let n=e.get("newPassword"),t=e.get("confirmPassword");if(n&&t&&n.value!==t.value)return t.setErrors({passwordMismatch:!0}),{passwordMismatch:!0};if(t?.errors?.passwordMismatch){let d=b({},t.errors);delete d.passwordMismatch,t.setErrors(Object.keys(d).length?d:null)}return null}onSubmit(){return P(this,null,function*(){if(this.resetPasswordForm.valid&&this.resetToken){this.isLoading=!0,this.errorMessage="";try{let e=this.resetPasswordForm.get("newPassword")?.value,n=this.resetPasswordForm.get("confirmPassword")?.value;yield this.resetPassword(this.resetToken,e,n),this.showSuccessMessage=!0,this.resetPasswordForm.reset(),setTimeout(()=>{this.router.navigate(["/login"],{queryParams:{message:"Password reset successfully. Please log in with your new password."}})},3e3)}catch(e){console.error("Error resetting password:",e),this.handleResetError(e)}finally{this.isLoading=!1}}else this.resetPasswordForm.markAllAsTouched(),this.resetToken?this.errorMessage="Please fill in all required fields correctly.":this.errorMessage="Invalid reset link. Please request a new password reset."})}handleResetError(e){e.status===400?this.errorMessage="Invalid or expired reset token. Please request a new password reset.":e.status===422?this.errorMessage=e.message||"Password validation failed. Please check your input.":e.status===429?this.errorMessage="Too many reset attempts. Please try again in a few minutes.":e.status===0?this.errorMessage="Unable to connect to server. Please check your internet connection.":this.errorMessage=e.message||"Failed to reset password. Please try again."}getFieldError(e){let n=this.resetPasswordForm.get(e);if(n&&n.invalid&&(n.dirty||n.touched)){if(n.errors?.required)return`${this.getFieldLabel(e)} is required`;if(n.errors?.minlength){let t=n.errors?.minlength.requiredLength;return`${this.getFieldLabel(e)} must be at least ${t} characters`}if(n.errors?.passwordMismatch)return"Passwords do not match"}return""}getFieldLabel(e){return{newPassword:"New Password",confirmPassword:"Confirm Password"}[e]||this.capitalizeFirst(e)}capitalizeFirst(e){return e.charAt(0).toUpperCase()+e.slice(1)}togglePasswordVisibility(e){e==="newPassword"?this.showPassword=!this.showPassword:this.showConfirmPassword=!this.showConfirmPassword}goBackToLogin(){this.router.navigate(["/login"])}requestNewResetLink(){this.router.navigate(["/forgot-password"])}resetPassword(e,n,t){return P(this,null,function*(){return new Promise((d,B)=>{this.authService.resetPassword(e,n,t).pipe(x(this.destroy$)).subscribe({next:()=>d(),error:V=>B(V)})})})}static \u0275fac=function(n){return new(n||i)(m(z),m(E),m(F),m(N))};static \u0275cmp=M({type:i,selectors:[["app-reset-password"]],decls:48,vars:17,consts:[[1,"reset-password-container"],[1,"reset-password-card"],[1,"logo-section"],[1,"logo"],[1,"form-section"],[1,"title"],[1,"subtitle"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","newPassword"],[1,"password-input-wrapper"],["id","newPassword","formControlName","newPassword","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",3,"type"],["type","button",1,"password-toggle",3,"click"],["class","error-message",4,"ngIf"],["for","confirmPassword"],["id","confirmPassword","formControlName","confirmPassword","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",3,"type"],["class","error-message general-error",4,"ngIf"],["type","submit",1,"reset-btn",3,"disabled"],[4,"ngIf"],["class","loading-text",4,"ngIf"],["class","success-message",4,"ngIf"],[1,"links-section"],[1,"back-link",3,"click"],["class","reset-link",3,"click",4,"ngIf"],[1,"side-section"],[1,"side-content"],[1,"side-title"],[1,"side-subtitle"],[1,"sign-in-btn",3,"click"],[1,"error-message"],[1,"error-message","general-error"],[1,"loading-text"],[1,"success-message"],[1,"reset-link",3,"click"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),s(4,"TaxPal"),o()(),r(5,"div",4)(6,"h2",5),s(7,"Reset Password"),o(),r(8,"p",6),s(9," Enter your new password below to complete"),u(10,"br"),s(11," the password reset process "),o(),r(12,"form",7),p("ngSubmit",function(){return t.onSubmit()}),r(13,"div",8)(14,"label",9),s(15,"New Password"),o(),r(16,"div",10),u(17,"input",11),r(18,"button",12),p("click",function(){return t.togglePasswordVisibility("newPassword")}),s(19),o()(),c(20,A,2,1,"div",13),o(),r(21,"div",8)(22,"label",14),s(23,"Confirm New Password"),o(),r(24,"div",10),u(25,"input",15),r(26,"button",12),p("click",function(){return t.togglePasswordVisibility("confirmPassword")}),s(27),o()(),c(28,$,2,1,"div",13),o(),c(29,G,2,1,"div",16),r(30,"button",17),c(31,Y,2,0,"span",18)(32,U,2,0,"span",19),o()(),c(33,H,5,0,"div",20),r(34,"div",21)(35,"a",22),p("click",function(){return t.goBackToLogin()}),s(36," \u2190 Back to Login "),o(),c(37,J,2,0,"a",23),o()(),r(38,"div",24)(39,"div",25)(40,"h2",26),s(41,"Create New"),u(42,"br"),s(43,"Password"),o(),r(44,"p",27),s(45,"Your new password must be different from previously used passwords"),o(),r(46,"button",28),p("click",function(){return t.goBackToLogin()}),s(47," Back to Login "),o()()()()()),n&2&&(a(12),l("formGroup",t.resetPasswordForm),a(5),h("error",t.getFieldError("newPassword")),l("type",t.showPassword?"text":"password"),a(2),g(" ",t.showPassword?"\u{1F441}\uFE0F":"\u{1F441}\uFE0F\u200D\u{1F5E8}\uFE0F"," "),a(),l("ngIf",t.getFieldError("newPassword")),a(5),h("error",t.getFieldError("confirmPassword")),l("type",t.showConfirmPassword?"text":"password"),a(2),g(" ",t.showConfirmPassword?"\u{1F441}\uFE0F":"\u{1F441}\uFE0F\u200D\u{1F5E8}\uFE0F"," "),a(),l("ngIf",t.getFieldError("confirmPassword")),a(),l("ngIf",t.errorMessage),a(),l("disabled",t.resetPasswordForm.invalid||t.isLoading),a(),l("ngIf",!t.isLoading),a(),l("ngIf",t.isLoading),a(),l("ngIf",t.showSuccessMessage),a(4),l("ngIf",t.errorMessage.includes("Invalid or expired")))},dependencies:[O,k,q,D,S,R,I,T,L],styles:['.reset-password-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#667eea,#764ba2);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;padding:20px}.reset-password-card[_ngcontent-%COMP%]{display:flex;background:#fff;border-radius:16px;box-shadow:0 20px 40px #0000001a;overflow:hidden;max-width:900px;width:100%;min-height:600px}.logo-section[_ngcontent-%COMP%]{background:#f8fafc;padding:40px;display:flex;align-items:flex-start;justify-content:center;flex:0 0 200px}.logo[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#1e293b;margin:0;text-align:center}.form-section[_ngcontent-%COMP%]{flex:1;padding:60px 50px;display:flex;flex-direction:column;justify-content:center}.title[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:#1e293b;margin:0 0 16px;line-height:1.2}.subtitle[_ngcontent-%COMP%]{font-size:16px;color:#64748b;margin:0 0 32px;line-height:1.5}.form-group[_ngcontent-%COMP%]{margin-bottom:24px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:14px;font-weight:500;color:#374151;margin-bottom:8px}.password-input-wrapper[_ngcontent-%COMP%]{position:relative}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:16px 50px 16px 16px;border:2px solid #e5e7eb;border-radius:12px;font-size:16px;transition:all .3s ease;box-sizing:border-box}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#4fd1c7;box-shadow:0 0 0 3px #4fd1c71a}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%]{border-color:#ef4444}.password-toggle[_ngcontent-%COMP%]{position:absolute;right:16px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;font-size:18px;color:#64748b;transition:color .3s ease}.password-toggle[_ngcontent-%COMP%]:hover{color:#4fd1c7}.error-message[_ngcontent-%COMP%]{color:#ef4444;font-size:14px;margin-top:8px}.general-error[_ngcontent-%COMP%]{background:#fef2f2;border:1px solid #fecaca;padding:12px 16px;border-radius:8px;margin-bottom:16px;text-align:center}.reset-btn[_ngcontent-%COMP%]{width:100%;background:#4fd1c7;color:#fff;border:none;padding:16px;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s ease;margin-bottom:24px}.reset-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#45b5aa;transform:translateY(-2px);box-shadow:0 8px 20px #4fd1c74d}.reset-btn[_ngcontent-%COMP%]:disabled{background:#94a3b8;cursor:not-allowed;transform:none}.loading-text[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px}.loading-text[_ngcontent-%COMP%]:after{content:"";width:16px;height:16px;border:2px solid transparent;border-top:2px solid currentColor;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.success-message[_ngcontent-%COMP%]{background:#dcfce7;color:#16a34a;padding:24px;border-radius:12px;margin-bottom:24px;text-align:center}.success-message[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;font-size:18px;font-weight:600}.success-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;opacity:.9}.links-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:16px}.back-link[_ngcontent-%COMP%], .reset-link[_ngcontent-%COMP%]{color:#4fd1c7;text-decoration:none;font-weight:500;cursor:pointer;transition:color .3s ease}.back-link[_ngcontent-%COMP%]:hover, .reset-link[_ngcontent-%COMP%]:hover{color:#45b5aa}.reset-link[_ngcontent-%COMP%]{font-size:14px}.side-section[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4fd1c7,#38bdf8);flex:0 0 300px;padding:60px 40px;display:flex;align-items:center;justify-content:center;color:#fff;position:relative;overflow:hidden}.side-section[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:radial-gradient(circle at 30% 80%,rgba(255,255,255,.1) 0%,transparent 50%)}.side-content[_ngcontent-%COMP%]{text-align:center;position:relative;z-index:1}.side-title[_ngcontent-%COMP%]{font-size:36px;font-weight:700;margin:0 0 20px;line-height:1.1}.side-subtitle[_ngcontent-%COMP%]{font-size:16px;margin:0 0 30px;opacity:.9;line-height:1.4}.sign-in-btn[_ngcontent-%COMP%]{background:#fff3;color:#fff;border:2px solid rgba(255,255,255,.3);padding:14px 32px;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s ease;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.sign-in-btn[_ngcontent-%COMP%]:hover{background:#ffffff4d;border-color:#ffffff80;transform:translateY(-2px)}@media (max-width: 768px){.reset-password-card[_ngcontent-%COMP%]{flex-direction:column;margin:20px;min-height:auto}.logo-section[_ngcontent-%COMP%]{flex:none;padding:30px 20px 20px}.form-section[_ngcontent-%COMP%]{padding:40px 30px}.side-section[_ngcontent-%COMP%]{flex:none;padding:40px 30px}.side-title[_ngcontent-%COMP%], .title[_ngcontent-%COMP%]{font-size:28px}.links-section[_ngcontent-%COMP%]{flex-direction:column;text-align:center}}@media (max-width: 480px){.reset-password-container[_ngcontent-%COMP%]{padding:10px}.form-section[_ngcontent-%COMP%], .side-section[_ngcontent-%COMP%]{padding:30px 20px}}']})};export{j as ResetPasswordComponent};
