<div class="layout">
  <main class="main-content">
    <header class="main-header">
      <h1 class="main-title">{{ mainHeader() }}</h1>
      <p class="main-subtitle">{{ mainSubheader() }}</p>
    </header>

    <div class="content-wrapper">
      <!-- Tax Estimator Navigation Tabs -->
      <div class="tax-nav" *ngIf="activePage() === 'tax-estimator'">
        <button class="tax-nav-btn" [class.active]="activeView() === 'calculator'" (click)="setActiveView('calculator')">
          Calculator
        </button>
        <button class="tax-nav-btn" [class.active]="activeView() === 'calendar'" (click)="setActiveView('calendar')">
          Calendar
        </button>
      </div>

      <!-- Tax Calculator View -->
      <div *ngIf="activeView() === 'calculator' && activePage() === 'tax-estimator'" class="tax-calculator-container">
        <div class="tax-form-card">
          <div class="tax-form-left">
            <h2 class="heading">Quarterly Tax Calculator</h2>
            <p class="form-subtitle">Calculate your estimated tax obligations</p>
            
            <div class="form-group-row">
              <div class="form-field">
                <label>Country/Region</label>
                <select [ngModel]="taxForm().country" (ngModelChange)="updateFormField('country', $event)">
                  <option>United States</option>
                  <option>India</option>
                  <option>China</option>
                  <option>Austalia</option>
                </select>
              </div>
              <div class="form-field">
                <label>State/Province</label>
                <select [ngModel]="taxForm().state" (ngModelChange)="updateFormField('state', $event)">
                  <option *ngFor="let state of states" [ngValue]="state">{{ state }}</option>
                </select>
              </div>
            </div>

            <div class="form-group-row">
              <div class="form-field">
                <label>Filing Status</label>
                <select [ngModel]="taxForm().filingStatus" (ngModelChange)="updateFormField('filingStatus', $event)">
                  <option *ngFor="let status of filingStatuses" [ngValue]="status">{{ status }}</option>
                </select>
              </div>
              <div class="form-field">
                <label>Quarter</label>
                <select [ngModel]="taxForm().quarter" (ngModelChange)="updateFormField('quarter', $event)">
                  <option *ngFor="let q of quarters" [ngValue]="q">{{ q }}</option>
                </select>
              </div>
            </div>

            <h3 class="form-section-title">Income</h3>
            <div class="form-field full-width">
              <label>Gross Income for Quarter</label>
              <input type="number" [ngModel]="taxForm().grossIncome" (ngModelChange)="updateFormField('grossIncome', $event)">
            </div>

            <h3 class="form-section-title">Deductions</h3>
            <div class="form-group-grid">
              <div class="form-field">
                <label>Business Expenses</label>
                <input type="number" [ngModel]="taxForm().deductions" (ngModelChange)="updateFormField('deductions', $event)">
              </div>
              <div class="form-field">
                <label>Retirement Contributions</label>
                <input type="number" [ngModel]="taxForm().retirementContributions" (ngModelChange)="updateFormField('retirementContributions', $event)">
              </div>
              <div class="form-field">
                <label>Health Insurance Premiums</label>
                <input type="number" [ngModel]="taxForm().healthInsurancePremiums" (ngModelChange)="updateFormField('healthInsurancePremiums', $event)">
              </div>
              <div class="form-field">
                <label>Home Office Deduction</label>
                <input type="number" [ngModel]="taxForm().homeOfficeDeduction" (ngModelChange)="updateFormField('homeOfficeDeduction', $event)">
              </div>
            </div>

            <button class="calculate-btn" type="button" (click)="calculateTax()" [disabled]="isLoading()">
              <span *ngIf="isLoading()">Calculating...</span>
              <span *ngIf="!isLoading()">Calculate Estimated Tax</span>
            </button>

            <!-- Messages -->
            <div class="error-message" *ngIf="errorMessage()">
              {{ errorMessage() }}
            </div>
            
            <div class="success-message" *ngIf="successMessage()">
              {{ successMessage() }}
            </div>
          </div><!-- end tax-form-left -->

          <div class="tax-summary-right">
            <h3 class="summary-title">Tax Summary</h3>
            <div class="summary-box">
              <i class="summary-icon">ðŸ§¾</i>
              <p>{{ taxSummaryMessage() }}</p>
              <div class="tax-result" *ngIf="taxForm().calculatedTax > 0">
                <div class="result-amount">{{ taxForm().calculatedTax | currency:'USD' }}</div>
              </div>
            </div>
          </div>
        </div><!-- end tax-form-card -->
      </div><!-- end tax-calculator-container -->

      <!-- Tax Calendar View -->
      <div *ngIf="activeView() === 'calendar' && activePage() === 'tax-estimator'" class="tax-calendar-container calendar-list">
        <h2>Tax Calendar</h2>
        
        <!-- Loading indicator -->
        <div class="loading-indicator" *ngIf="isLoading()">
          <p>Loading tax reminders...</p>
          <div class="spinner"></div>
        </div>
        
        <!-- Empty state -->
        <div class="empty-state" *ngIf="!isLoading() && taxCalendar().length === 0">
          <p>No tax reminders found.</p>
          <p class="empty-state-action">Calculate your estimated tax to generate reminders for upcoming payments.</p>
        </div>
        
        <!-- Calendar content -->
        <div class="calendar-content" *ngIf="!isLoading() && taxCalendar().length > 0">
          <div class="month-section" *ngFor="let month of taxCalendar(); trackBy: trackByMonth">
            <h3 class="month-title">{{ month.month }}</h3>
            <div class="reminders-list">
              <div class="reminder-card"
                   *ngFor="let reminder of month.reminders; trackBy: trackByReminderId"
                   [class.payment]="reminder.type === 'payment'"
                   [class.reminder]="reminder.type === 'reminder'">
                <div class="reminder-date">{{ reminder.date }}</div>
                <div class="reminder-details">
                  <div class="reminder-title">{{ reminder.title }}</div>
                  <div class="reminder-description">{{ reminder.description }}</div>
                </div>
                <div class="reminder-status">
                  <span class="reminder-type-tag" [class]="reminder.type">{{ reminder.type }}</span>
                  <button
                    class="btn-mark-done"
                    [ngClass]="{ 'done': reminder.type === 'payment' }"
                    (click)="markReminderDone(reminder.id)"
                    [attr.aria-pressed]="reminder.type === 'payment'"
                    [disabled]="isLoading()"
                    title="{{ reminder.type === 'payment' ? 'Already paid' : 'Mark as paid' }}"
                  >
                    {{ reminder.type === 'payment' ? 'Paid' : (isLoading() ? 'Saving...' : 'Mark as Paid') }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>